---
title: TCP、UDP以及HTTP的简单讲解
tags: tcp/ip
notebook: 计算机网络
---

[TOC]

# 详解

## TCP/IP参考模型

TCP/IP参考模型分为四层：应用层、运输层、网络层和接口层。浏览器所完成的工作就属于应用层的范畴。(记住图片)
![pic1](https://pic2.zhimg.com/0ff21f5171c24887eba7b2d61f33921d_b.jpg)

- 应用层： 为用户提供各种服务，比如我们浏览网页时用到的HTTP，收发邮件时用的SMTP，登录远程主机用的SSH。
- 传输层：提供端到端的传输服务。更具体地讲，提供进程到进程的传输服务。
- 网络层：和传输层一样，可以概括为提供端到端的传输服务。更具体地讲，网络层提供主机到主机的传输服务。
- 网络接口层（链路层）：为直接连接的设备提供传输服务，将数据帧转换为比特流，并将比特流转换为物理电路的电压高低信号。

## TCP协议

TCP（Transmission Control Protocol，传输控制协议）是基于连接的协议，也就是说，在正式收发数据前，必须和对方建立可靠的连接。一个TCP连接必须要经过三次“对话”才能建立起来，其中的过程非常复杂，我们这里只做简单、形象的介绍，你只要做到能够理解这个过程即可。我们来看看这三次对话的简单过程：主机A向主机B发出连接请求数据包：“我想给你发数据，可以吗？”，这是第一次对话；主机B向主机A发送同意连接和要求同步（同步就是两台主机一个在发送，一个在接收，协调工作）的数据包：“可以，你什么时候发？”，这是第二次对话；主机A再发出一个数据包确认主机B的要求同步：“我现在就发，你接着吧！”，这是第三次对话。三次“对话”的目的是使数据包的发送和接收同步，经过三次“对话”之后，主机A才向主机B正式发送数据。

### tcp协议3次握手

- 第一次握手：建立连接时，客户端发送syn包（syn=j）到服务器，并进入SYN_SENT状态，等待服务器确认；SYN：同步序列编号（Synchronize Sequence Numbers）。

- 第二次握手：服务器收到syn包，必须确认客户的SYN（ack=j+1），同时自己也发送一个SYN包（syn=k），即SYN+ACK包，此时服务器进入SYN_RECV状态；ACK:确认字符(Acknowledgement)

- 第三次握手：客户端收到服务器的SYN+ACK包，向服务器发送确认包ACK(ack=k+1），此包发送完毕，客户端和服务器进入ESTABLISHED（TCP连接成功）状态，完成三次握手。

![pic](http://blog.chinaunix.net/attachment/201304/8/22312037_1365405910EROI.png)

上图中有几个字段需要重点介绍下：
（1）序号：Seq序号，占32位，用来标识从TCP源端向目的端发送的字节流，发起方发送数据时对此进行标记。
（2）确认序号：Ack序号，占32位，只有ACK标志位为1时，确认序号字段才有效，Ack=Seq+1。
（3）标志位：共6个，即URG、ACK、PSH、RST、SYN、FIN等，具体含义如下：
        （A）URG：紧急指针（urgent pointer）有效。
        （B）ACK：确认序号有效。
        （C）PSH：接收方应该尽快将这个报文交给应用层。
        （D）RST：重置连接。
        （E）SYN：发起一个新连接。
        （F）FIN：释放一个连接。

需要注意的是：
        （A）不要将确认序号Ack与标志位中的ACK搞混了。
        （B）确认方Ack=发起方Req+1，两端配对。 

### 四次挥手


## UDP协议

UDP（User Data Protocol，用户数据报协议）是与TCP相对应的协议。它是面向非连接的协议，它不与对方建立连接，而是直接就把数据包发送过去！ 
UDP适用于一次只传送少量数据、对可靠性要求不高的应用环境。比如，我们经常使用“ping”命令来测试两台主机之间TCP/IP通信是否正常，其实“ping”命令的原理就是向对方主机发送UDP数据包，然后对方主机确认收到数据包，如果数据包是否到达的消息及时反馈回来，那么网络就是通的。例如，在默认状态下，一次“ping”操作发送4个数据包（如图2所示）。大家可以看到，发送的数据包数量是4包，收到的也是4包（因为对方主机收到后会发回一个确认收到的数据包）。这充分说明了UDP协议是面向非连接的协议，没有建立连接的过程。正因为UDP协议没有连接的过程，所以它的通信效果高；但也正因为如此，它的可靠性不如TCP协议高。QQ就使用UDP发消息，因此有时会出现收不到消息的情况。